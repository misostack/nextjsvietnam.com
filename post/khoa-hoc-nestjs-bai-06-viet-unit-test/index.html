<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=home href=https://nextjsvietnam.com>
<meta name=generator content="jsguru cms">
<link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap">
<link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/main.css>
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/home.css>
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/page.css>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RWE4MLJYE6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-RWE4MLJYE6')</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1642510310947288" crossorigin=anonymous></script>
<title>Khóa học NestJS - Bài 06 Hướng dẫn viết Unit Test | Cùng tìm hiểu cách viết unit test và cách mà nó giúp ích cho bạn cũng như dự án | Useful NodeJS Tricks, JavaScript Tips, Tricks and Best Practices</title>
<meta name=robots content="all">
<meta name=keywords content="nestjs,nestjs-mvc,nestjs-tutorial">
<meta name=description content="Cùng tìm hiểu cách viết unit test và cách mà nó giúp ích cho bạn cũng như dự án">
<meta property="og:type" content="website">
<meta property="og:image" content="https://user-images.githubusercontent.com/31009750/181449337-70081a76-5a01-4229-805e-39ed0ded6b5b.png">
<meta property="og:image:type" content="image/jpeg">
<meta property="og:image:width" content="750">
<meta property="og:image:height" content="300">
<meta property="article:publisher" content="https://www.facebook.com/nextjsvietnam">
<meta property="article:published_time" content="2023-07-06T21:52:16+07:00">
<meta property="article:modified_time" content="2023-07-06T21:52:16+07:00">
<link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png>
<link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png>
<link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png>
<link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png>
<link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png>
<link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png>
<link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png>
<link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png>
<link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png>
<link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<meta name=msapplication-TileColor content="#ffffff">
<meta name=msapplication-TileImage content="/ms-icon-144x144.png">
<meta name=theme-color content="#ffffff">
</head>
<body class=body-nav-fixed>
<nav class="nav-fixed nav-default z-50">
<div class=container>
<div class="nav-container flex flex-wrap justify-between items-center">
<a href=https://nextjsvietnam.com class="nav-brand inline-block">
<img class=h-12 src=https://nextjsvietnam.com/themes/2022/src/assets/images/logo.png alt=Stunning>
</a>
<a href=javascript:void(0); data-menu=#menu-main_menu class=nav-menu-toggle><span class=material-icons>menu</span></a>
<ul id=menu-main_menu class="nav-menu h-0 md:h-auto">
<form class="nav-menu-search-bar md:hidden relative">
<button class="nav-menu-search-bar-search-btn absolute h-full"><svg class="w-3 h-3 text-gray-600" fill="currentcolor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.32 14.9l5.39 5.4a1 1 0 01-1.42 1.4l-5.38-5.38a8 8 0 111.41-1.41zM10 16a6 6 0 100-12 6 6 0 000 12z"/></svg>
</button>
<input name=s type=text class=w-full>
</form>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com/categories/systemdesign>System Design
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/software-architecture>Software Architecture</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/microservice-architecture>Microservice Architecture</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/aws>Learn AWS The Right Way</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/aws-labs>AWS Hands-On Labs</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com/categories/cheatsheet>Cheatsheet
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nestjs-examples>NestJS Examples</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/reactjs-examples>ReactJS Examples</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/react-native-examples>React Native Examples</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com/categories/frameworks>Frameworks
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nestjs>NestJS</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/reactjs>ReactJS</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nextjs>NextJS</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com>Tutorials
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nestjs-tutorial>NestJS Tutorial</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/reactjs-tutorial>ReactJS Tutorial</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nextjs-tutorial>NextJS Tutorial</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com>Tools
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://regex101.com/>Online Regex</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=http://www.bashoneliners.com/>Bash Online</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://www.epochconverter.com/>Unix Timestamp Conversion</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://ryanstutorials.net/bash-scripting-tutorial/>Bash Scripting</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://explainshell.com/>Explain Shell</a></li>
</ul>
</li>
<form class="nav-menu-search-bar hidden md:flex relative">
<button class="nav-menu-search-bar-search-btn absolute h-full"><svg class="w-3 h-3 text-gray-600" fill="currentcolor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.32 14.9l5.39 5.4a1 1 0 01-1.42 1.4l-5.38-5.38a8 8 0 111.41-1.41zM10 16a6 6 0 100-12 6 6 0 000 12z"/></svg>
</button>
<input name=s type=text class=w-full>
</form>
</ul>
</div>
</div>
</nav>
<main>
<section class="container section">
<div class="page-content max-w-2xl mx-auto">
<img src=https://user-images.githubusercontent.com/31009750/181449337-70081a76-5a01-4229-805e-39ed0ded6b5b.png class=img-responsive alt="Khóa học NestJS - Bài 06 Hướng dẫn viết Unit Test">
<h1>Khóa học NestJS - Bài 06 Hướng dẫn viết Unit Test</h1>
<p><strong>Post Date</strong> : 2023-07-06T21:52:16+07:00</p>
<p><strong>Modified Date</strong> : 2023-07-06T21:52:16+07:00</p>
<p>
<strong>Category:</strong>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=https://nextjsvietnam.com/categories/nestjs-tutorial>nestjs-tutorial</a>
</p>
<p>
<strong>Tags:</strong>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=/tags/nestjs>nestjs</a>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=/tags/nestjs-pet-website>, nestjs-pet-website</a>
</p>
<ul>
<li><a href=https://github.com/misostack/nestjs2024/tree/course-basic/lession-06>Lession 06 Source Code</a></li>
</ul>
<h2 id=bài-06>Bài 06</h2>
<ol>
<li>Giới thiệu sơ qua về Unit Test</li>
<li>Cách test một service trong NestJS</li>
<li>Hướng dẫn debug unit test trong NestJS</li>
<li>Ứng dụng viết Unit Test cho PetCategory</li>
</ol>
<p>Đầu tiên, các anh/chị có thể thấy rằng sẽ có một mối quan hệ mật thiết giữa 3 thứ trong ngành này: errors/bugs(lỗi), stress(căng thẳng), tests(kiểm tra)</p>
<p><img src=https://user-images.githubusercontent.com/31009750/261230050-80f15af7-6ed7-49fd-9907-6bb248aa7137.png alt=image></p>
<ol>
<li>Càng nhiều lỗi (errors/bugs) thì càng căng thẳng(stress)</li>
<li>Càng căng thẳng(stress) thì càng tạo ra nhiều lỗi(errors/bugs)</li>
<li>Càng kiểm tra nhiều(test) thì càng ít lỗi(errors/bugs) do đã phát hiện và được sửa</li>
<li>Càng ít lỗi(errors/bugs) thì càng ít cằng thẳng(stress)</li>
</ol>
<p>Do đó, việc test nhiều/kĩ sẽ đảm bảo được các anh/chị sẽ ít căng thẳng(stress) hơn.</p>
<p>Tiếp theo tôi xin giới thiệu với các anh/chị nghệ thuật viết test như thế nào cho đúng. Trước tiên, tôi xin phép đi qua một khái niệm tổng quát về testing trong ngành phần mềm.</p>
<blockquote>
<p>Kim tự tháp kiểm thử phần mềm</p>
</blockquote>
<p><img src=https://user-images.githubusercontent.com/31009750/261233946-8a85e14e-e153-4dd0-a22c-ced35255d20c.png alt=image></p>
<p>Bao gồm tất cả các giai đoạn của vòng đời phát triển phần mềm (SDLC). Nó bắt đầu từ unit testing, đến kiểm thử tích hợp (integration testing) và kết thúc với kiểm thử chức năng ở đỉnh(e2e)</p>
<p>Không có sự phân bổ cố định giữa các loại kiểm thử này. Thay vào đó, bạn nên xác định những bài kiểm thử nào phù hợp nhất với nhu cầu của bạn dựa vào việc cân đối chi phí, thời gian thực hiện và tài nguyên cho từng loại kiểm thử.</p>
<p>Các nhà phát triển phần mềm Agile cũng sử dụng phương pháp góc phần tư kiểm thử phần mềm ( Software Testing Quadrants) để phân loại các kiểm thử theo <strong>nghiệp vụ</strong>(business-facing) hay <strong>technology facing</strong>(công nghệ) nhằm tìm ra những bất cập của sản phẩm(critique product) và hỗ trợ đội ngũ phát triển xây dựng và thay đổi ứng dụng 1 cách tự tin.</p>
<p><img src=https://user-images.githubusercontent.com/31009750/261236689-fd1a32e5-bd46-439f-a455-997507a259e6.png alt=image></p>
<p>Vậy là chúng ta đã đi qua tổng quan về một số khái niệm cũng như phương pháp kiểm thử phần mềm. Trong phạm vi bài viết này, tôi sẽ tập trung trình bày vào 2 phần chính:</p>
<ul>
<li>Unit Tests</li>
</ul>
<h2 id=vậy-viết-unit-test-cụ-thể-là-làm-gì>Vậy viết Unit Test cụ thể là làm gì</h2>
<p>Các anh/chị cố gắng ghi nhớ định nghĩa đơn giản sau đây, để phân tích và áp dụng được unit test vào trong dự án mà không tốn quá nhiều thời gian/tài nguyên.</p>
<blockquote>
<p>Unit test được áp dụng để kiểm tra logic của một đoạn code thuộc 1 phần mềm. Đôi khi trong một hệ thống, cũng có thể tình một module là 1 unit.</p>
</blockquote>
<h2 id=công-cụ-hỗ-trợ-viết-unit-test>Công cụ hỗ trợ viết Unit Test</h2>
<p>Các anh/chị có 2 lựa chọn khi viết Unit Test:</p>
<ul>
<li><input checked disabled type=checkbox> Tự xây dựng 1 framework hỗ trợ viết Unit Test</li>
<li><input checked disabled type=checkbox> Sử dụng 1 framework Unit Test có sẵn trong hệ sinh thái</li>
</ul>
<p>Framework được xây dựng/lựa chọn cần phải đáp ứng các tiêu chí sau:</p>
<ul>
<li>Dễ setup và well document</li>
<li>Hỗ trợ tạo test suite, gom nhóm các test case</li>
<li>Hỗ trợ các util cho việc kiểm tra kết quả</li>
<li>Hỗ trợ Mock/Stub</li>
<li>Hỗ trợ Async</li>
<li>Hỗ trợ report</li>
</ul>
<p>Các framework Unit Test hiện tại trong hệ sinh thái NodeJS được gom thành 2 trường phái:</p>
<p><img src="https://github.com/misostack/typescript-examples/blob/master/images/tdd-vs-bdd.png?raw=true" alt="NodeJS Testing Frameworks"></p>
<ol>
<li>JestJS : support jsdom, BDD style ( support typescript )</li>
<li>Jasmine: BDD style</li>
<li>Mocha(Testing Framework) & Chai(Assertion Libs): TDD style</li>
</ol>
<p>Trong phạm vi của bài viết này, tôi sẽ chia sẻ với các anh/chị về một số cú pháp/khái niệm khi sử dụng JestJS ( testing framework được giới thiệu chung với NestJS). Do đó mục này sẽ gồm 2 phần:</p>
<ol>
<li>Tìm hiểu và thực hành 1 số khái niệm cùng với JestJS</li>
<li>Tìm hiểu và thực hành Unit Test cùng với JestJS trên nên tảng web/api được viết bằng NestJS</li>
</ol>
<h3 id=tìm-hiểu-và-thực-hành-một-số-khái-niệm-cùng-với-jestjs>Tìm hiểu và thực hành một số khái niệm cùng với JestJS</h3>
<ol>
<li><input checked disabled type=checkbox> Cấu hình hỗ trợ module alias cho file test</li>
<li><input checked disabled type=checkbox> Cấu hình debug file test trong vscode</li>
<li><input checked disabled type=checkbox> Giới thiệu một số function test cơ bản của jest</li>
</ol>
<h4 id=1cấu-hình-hỗ-trợ-module-alias-cho-file-test>1.Cấu hình hỗ trợ module alias cho file test</h4>
<blockquote>
<p>Mặc định NestJS đã tích hợp và cấu hình JestJS vào trong framework</p>
</blockquote>
<p>Có 1 số điểm cần lưu ý như sau:</p>
<ul>
<li>Module Alias in Test File</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>validate</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;class-validator&#39;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CreateExampleDto</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./example-dtos&#39;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>plainToInstance</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;class-transformer&#39;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>CLASS_VALIDATOR_VALIDATION_OPTIONS</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@modules/constants&#39;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>describe</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;node:test&#39;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>isEqual</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;lodash&#39;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>transformClassValidatorErrors</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;@modules/helpers/class-validator.helpers&#39;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>inspect</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;node:util&#39;</span>;
</code></pre></div><p>Để sử dụng alias trong file test (*.test.ts | *.spec.ts) các anh/chị cần thêm dòng config sau.</p>
<p>Đối với path alias như dưới <strong>tsconfig.json</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>    <span style=color:#e6db74>&#34;paths&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
      <span style=color:#f92672>&#34;@modules/*&#34;</span>: [<span style=color:#e6db74>&#34;src/*&#34;</span>],
      <span style=color:#f92672>&#34;@database/*&#34;</span>: [<span style=color:#e6db74>&#34;src/database/*&#34;</span>]
    }<span style=color:#960050;background-color:#1e0010>,</span>
</code></pre></div><p>Thì tương ứng trong file <strong>package.json</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts>  <span style=color:#e6db74>&#34;jest&#34;</span><span style=color:#f92672>:</span> {
    ...
    <span style=color:#e6db74>&#34;moduleNameMapper&#34;</span><span style=color:#f92672>:</span> {
      <span style=color:#e6db74>&#34;@modules/(.*)&#34;</span><span style=color:#f92672>:</span> [
        <span style=color:#e6db74>&#34;&lt;rootDir&gt;/$1&#34;</span>
      ],
      <span style=color:#e6db74>&#34;@database/(.*)&#34;</span><span style=color:#f92672>:</span> [
        <span style=color:#e6db74>&#34;&lt;rootDir&gt;/database/$1&#34;</span>
      ]
    },
    <span style=color:#e6db74>&#34;testTimeout&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>30000</span>
  }
</code></pre></div><h4 id=2cấu-hình-debug-file-test-trong-vscode>2.Cấu hình debug file test trong vscode</h4>
<blockquote>
<p>.vscode/launch.json</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;configurations&#34;</span>: [
    {
      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;node&#34;</span>,
      <span style=color:#f92672>&#34;request&#34;</span>: <span style=color:#e6db74>&#34;launch&#34;</span>,
      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Debug:JestFile&#34;</span>,
      <span style=color:#f92672>&#34;cwd&#34;</span>: <span style=color:#e6db74>&#34;${workspaceRoot}&#34;</span>,
      <span style=color:#f92672>&#34;program&#34;</span>: <span style=color:#e6db74>&#34;${workspaceFolder}/node_modules/jest/bin/jest.js&#34;</span>,
      <span style=color:#f92672>&#34;args&#34;</span>: [<span style=color:#e6db74>&#34;${fileBasenameNoExtension}&#34;</span>],
      <span style=color:#f92672>&#34;console&#34;</span>: <span style=color:#e6db74>&#34;integratedTerminal&#34;</span>,
      <span style=color:#f92672>&#34;envFile&#34;</span>: <span style=color:#e6db74>&#34;${workspaceFolder}/.env.test&#34;</span>
    }
  ]
}
</code></pre></div><h4 id=3giới-thiệu-một-số-function-test-cơ-bản-của-jest>3.Giới thiệu một số function test cơ bản của jest</h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>{
  <span style=color:#e6db74>&#34;jest&#34;</span><span style=color:#f92672>:</span> {
    <span style=color:#e6db74>&#34;moduleFileExtensions&#34;</span><span style=color:#f92672>:</span> [
      <span style=color:#e6db74>&#34;js&#34;</span>,
      <span style=color:#e6db74>&#34;json&#34;</span>,
      <span style=color:#e6db74>&#34;ts&#34;</span>
    ],
    <span style=color:#e6db74>&#34;rootDir&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;src&#34;</span>,
    <span style=color:#e6db74>&#34;testRegex&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;.*\\.spec\\.ts$&#34;</span>,
    <span style=color:#e6db74>&#34;transform&#34;</span><span style=color:#f92672>:</span> {
      <span style=color:#e6db74>&#34;^.+\\.(t|j)s$&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;ts-jest&#34;</span>
    },
    <span style=color:#e6db74>&#34;collectCoverageFrom&#34;</span><span style=color:#f92672>:</span> [
      <span style=color:#e6db74>&#34;**/*.(t|j)s&#34;</span>
    ],
}
</code></pre></div><p><strong>package.json</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>  <span style=color:#e6db74>&#34;scripts&#34;</span><span style=color:#f92672>:</span> {
    <span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jest&#34;</span>,
    <span style=color:#e6db74>&#34;test:watch&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jest --watch&#34;</span>,
    <span style=color:#e6db74>&#34;test:cov&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jest --coverage&#34;</span>,
    <span style=color:#e6db74>&#34;test:debug&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand&#34;</span>,
    <span style=color:#e6db74>&#34;test:e2e&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jest --config ./test/jest-e2e.json&#34;</span>,
  },
</code></pre></div><p>Cấu hình mặc định khi chạy lệnh test thì jest sẽ duyệt qua toàn bộ các file *.spec.ts trong thư mục source.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># execute jest command</span>
npm run test
</code></pre></div><p><img src=https://gist.github.com/assets/31009750/648e0d33-64ff-4c1f-9b13-bbd4e998fb0b alt=image></p>
<p>Các anh/chị có thể thấy, trong source code đã có 1 số file test có sẵn, kết quả cho thấy có 1 số chạy đúng, 1 số chạy sai.</p>
<p>Việc viết test này như đã nói có thể chạy tự động, do đó việc kiểm tra code có thể tự động hóa, giúp giảm thiểu thời gian, cũng như phát hiện lỗi ngay lập tức.</p>
<p>Cùng viết thử Unit Test nào.</p>
<p>Hãy tạo 2 file trong thư mục src/example như sau:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#a6e22e>calculation</span>.<span style=color:#a6e22e>ts</span>
<span style=color:#a6e22e>calculation</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>ts</span>
</code></pre></div><p>Ở bước này, nếu sử dụng vscode, các anh chị có thể cài thêm extension này <strong>vscode-jest-snippets</strong>, mục đích nhắc các lệnh cơ bản của jest</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#75715e>// calculation.ts
</span><span style=color:#75715e></span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ICalculation</span>{
    <span style=color:#a6e22e>add</span>(...<span style=color:#a6e22e>numbers</span>: <span style=color:#66d9ef>number</span>[])<span style=color:#f92672>:</span><span style=color:#66d9ef>number</span>;
    <span style=color:#a6e22e>substract</span>(<span style=color:#a6e22e>a</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>b</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span>;
    <span style=color:#a6e22e>asyncCalculation</span>(<span style=color:#a6e22e>a</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>b</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>number</span>&gt;
}

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Calculation</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>ICalculation</span> {
    <span style=color:#a6e22e>add</span>(...<span style=color:#a6e22e>numbers</span>: <span style=color:#66d9ef>number</span>[])<span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>numbers</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>prev</span>, <span style=color:#a6e22e>current</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>prev</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>current</span>, <span style=color:#ae81ff>0</span>);
    }
    <span style=color:#a6e22e>substract</span>(<span style=color:#a6e22e>a</span>:<span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>b</span>:<span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>number</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>b</span>;
    }
    <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>asyncCalculation</span>(<span style=color:#a6e22e>a</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>b</span>: <span style=color:#66d9ef>number</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>number</span>&gt; {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Promise</span>(<span style=color:#a6e22e>resolve</span> <span style=color:#f92672>=&gt;</span> {
            <span style=color:#a6e22e>setTimeout</span>(()<span style=color:#f92672>=&gt;</span>{
                <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>a</span><span style=color:#f92672>*</span><span style=color:#a6e22e>b</span>)
            },<span style=color:#ae81ff>500</span>)
        })
    }    
}

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>Calculation</span>;
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#75715e>// calculation.spec.ts
</span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Calculation</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./calculation&#34;</span>;

<span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;Calculation&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>calculation</span>: <span style=color:#66d9ef>Calculation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
    <span style=color:#a6e22e>beforeAll</span>(()<span style=color:#f92672>=&gt;</span>{
        <span style=color:#a6e22e>calculation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Calculation</span>();
    })
    <span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;add&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
        <span style=color:#a6e22e>test</span>(<span style=color:#e6db74>&#39;TC1: two integer numbers&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;            
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expectedValue</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>calculatedValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>calculation</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>);
            <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>calculatedValue</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expectedValue</span>);
        });
        <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;TC2: 3 integer numbers&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;            
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expectedValue</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>;
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>calculatedValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>calculation</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>c</span>);
            <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>calculatedValue</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expectedValue</span>);            
        })
    });
    <span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;substract&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
        <span style=color:#a6e22e>test</span>(<span style=color:#e6db74>&#39;TC1: two integer numbers&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;            
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expectedValue</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>calculatedValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>calculation</span>.<span style=color:#a6e22e>substract</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>)
            <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>calculatedValue</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expectedValue</span>);
        })
    });    
    <span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;asyncCalculation&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
        <span style=color:#a6e22e>test</span>(<span style=color:#e6db74>&#39;TC1: two integer numbers&#39;</span>, <span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;            
            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>expectedValue</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>; <span style=color:#75715e>// 3 * 2
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>calculatedValue</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>calculation</span>.<span style=color:#a6e22e>asyncCalculation</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>)
            <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>calculatedValue</span>).<span style=color:#a6e22e>toEqual</span>(<span style=color:#a6e22e>expectedValue</span>);
        })        
    })
});
</code></pre></div><p>Các điểm đặt breakpoint, khi bấm F5 để chạy debug, các anh chị sẽ thấy chúng lần lượt đi qua các điểm.</p>
<p>Về cơ bản:</p>
<ul>
<li>beforeAll: function callback khai báo trong đây sẽ chạy 1 lần trước tất cả các testcases</li>
<li>describe: để group các test case lại theo nhóm</li>
<li>it, test: để khai báo 1 test case và viết hàm kiểm tra</li>
<li>expect(valueA).toEqual(valueB) : phương thức sẵn có của jest giúp compare giá trị tính toán với giá trị mong đợi</li>
</ul>
<p><img src=https://gist.github.com/assets/31009750/020627c0-7aef-4abf-9a17-fd1e07d326e1 alt=image></p>
<h2 id=thực-hành-viết-unit-test-cho-todolist-api>Thực hành viết Unit Test cho TodoList API</h2>
<p>Chúng ta có sơ đồ thiết kế tổng quan như sau</p>
<p><img src=https://github.com/misostack/nestjs2024/assets/31009750/c028d2be-2440-44f6-8044-5f3561cd9182 alt=image></p>
<h2 id=tham-khảo>Tham khảo</h2>
<ul>
<li><a href=https://www.guru99.com/component-testing.html>https://www.guru99.com/component-testing.html</a> - Component Testing</li>
<li><a href=https://www.onpathtesting.com/blog/what-are-agile-testing-quadrants>https://www.onpathtesting.com/blog/what-are-agile-testing-quadrants</a> - Agile testing quadrants</li>
<li><a href=https://circleci.com/blog/component-vs-unit-testing/>https://circleci.com/blog/component-vs-unit-testing/</a> - Component vs Unit Testing</li>
</ul>
<div class="m-1 p-1">
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=https://nextjsvietnam.com/categories/nestjs-tutorial>nestjs-tutorial</a>
</div>
</div>
</section>
<section class="container section">
<div class="max-w-2xl mx-auto">
<div class="font-heading text-2xl font-semibold">You Might Also Like</div>
<div class="mt-8 grid gap-8">
<ul class=sidebar-links>
<li><a href=/post/khoa-hoc-nestjs-bai-05-repository-pattern/>Khóa học NestJS Bài 05 - Repository Pattern</a></li>
<li><a href=/post/khoa-hoc-nestjs-bai-04-model-and-repository-pattern/>Khóa học NestJS Bài 04 - Model and Repository Pattern</a></li>
<li><a href=/post/khoa-hoc-nestjs-bai03/>Khóa học NestJS Bài 03 - Controllers & Views</a></li>
<li><a href=/post/khoa-hoc-nestjs-bai-02/>Khóa học Nestjs - Bài 02 - Giới thiệu mô hình MVC</a></li>
<li><a href=/post/khoa-hoc-nestjs/>Khóa học NestJS - Bài 01 - Lộ trình các bài học về NestJS Framework</a></li>
</ul>
</div>
</div>
</section>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1642510310947288" crossorigin=anonymous></script>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1642510310947288 data-ad-slot=9309117729></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script>
</main>
<footer class=footer>
<div class="container md:flex">
<section class="footer-section-info md:basis-1/4">
<div class=address>
<a class=logo href=https://nextjsvietnam.com title=NextJSVietNam>
NextJSVietNam
</a>
<h4 class=footer-heading>
PRODUCTION MODE
<h4>
</div>
</section>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>NestJS</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/nestjs-passing-data-between-layers-in-ddd/>Nestjs Passing Data Between Layers in Domain Driven Design</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai-06-viet-unit-test/>Khóa học NestJS - Bài 06 Hướng dẫn viết Unit Test</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai-05-repository-pattern/>Khóa học NestJS Bài 05 - Repository Pattern</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai-04-model-and-repository-pattern/>Khóa học NestJS Bài 04 - Model and Repository Pattern</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai03/>Khóa học NestJS Bài 03 - Controllers & Views</a></li>
</ul>
</div>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>NextJS</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nextjs-bai-02-cau-truc-du-an-nextjs/>Khoá học NextJS 2024 - Bài 02: Cấu trúc dự án NextJS</a></li>
<li><a href=https://nextjsvietnam.com/post/create-new-website-with-nextjs/>Create New Website With Nextjs</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nextjs/>Khóa học NextJS - Bài 01 - Lộ trình các bài học về NextJS</a></li>
</ul>
</div>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>Cheatsheet</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/6minutes-tech-progressive-web-app/>6minutes Tech Progressive Web App</a></li>
<li><a href=https://nextjsvietnam.com/post/flexbox-and-real-world-examples/>Flexbox and Real World Examples</a></li>
<li><a href=https://nextjsvietnam.com/post/react-native-examples-setup-working-place-for-react-native-developer/>[React Native Examples] Setup Working Place for React Native Developer</a></li>
<li><a href=https://nextjsvietnam.com/post/happy-new-year-2024/>Happy New Year 2024</a></li>
<li><a href=https://nextjsvietnam.com/post/developer-philosophy/>Developer Philosophy</a></li>
</ul>
</div>
</div>
<div class=container>
<div class=text-center>
<a href><span class="material-icons text-4xl m-4">facebook</span></a>
<a href><span class="material-icons text-4xl m-4">smart_display</span></a>
</div>
<div class="text-center text-lg py-4">
Copyright @ NextJSVietNam 2022
</div>
<div class="text-center text-sm">
Powered by <a class="font-bold text-primary" href=https://gohugo.io/>Go Hugo</a> - Made
with love from <a class="font-bold text-primary" href=https://nextjsvietnam.com>NextJSVietNam</a> -
Build
Version 2024-05-18 09:05:19 +0700 +0700
</div>
</div>
</footer>
<script type=text/javascript src=https://nextjsvietnam.com/core/jquery-3.6.0.min.js></script>
<script type=text/javascript src=https://nextjsvietnam.com/themes/2022/public/main.js></script>
<script type=text/javascript src=https://nextjsvietnam.com/themes/2022/public/home.js></script>
<script async>!function(b,e,f,g,a,c,d){if(b.fbq)return;a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version='2.0',a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js'),fbq('init','1760611910980690'),fbq('track','PageView')</script>
<noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=1760611910980690&ev=PageView&noscript=1"></noscript>
</body>
</html>