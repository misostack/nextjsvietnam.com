<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=home href=https://nextjsvietnam.com>
<meta name=generator content="jsguru cms">
<link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap">
<link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/main.css>
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/home.css>
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/page.css>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RWE4MLJYE6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-RWE4MLJYE6')</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1642510310947288" crossorigin=anonymous></script>
<title>Microservice Headfirst | In this post, you will learn how to design a simple microservices system | Useful NodeJS Tricks, JavaScript Tips, Tricks and Best Practices</title>
<meta name=robots content="all">
<meta name=keywords content="microservice-architecture">
<meta name=description content="In this post, you will learn how to design a simple microservices system">
<meta property="og:type" content="website">
<meta property="og:image" content="https://user-images.githubusercontent.com/31009750/269891173-f10b1b6b-ea34-4e23-91b6-db9e995d6bff.png">
<meta property="og:image:type" content="image/jpeg">
<meta property="og:image:width" content="750">
<meta property="og:image:height" content="300">
<meta property="article:publisher" content="https://www.facebook.com/nextjsvietnam">
<meta property="article:published_time" content="2024-04-19T08:27:33+07:00">
<meta property="article:modified_time" content="2024-04-19T08:27:33+07:00">
<link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png>
<link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png>
<link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png>
<link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png>
<link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png>
<link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png>
<link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png>
<link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png>
<link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png>
<link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<meta name=msapplication-TileColor content="#ffffff">
<meta name=msapplication-TileImage content="/ms-icon-144x144.png">
<meta name=theme-color content="#ffffff">
</head>
<body class=body-nav-fixed>
<nav class="nav-fixed nav-default z-50">
<div class=container>
<div class="nav-container flex flex-wrap justify-between items-center">
<a href=https://nextjsvietnam.com class="nav-brand inline-block">
<img class=h-12 src=https://nextjsvietnam.com/themes/2022/src/assets/images/logo.png alt=Stunning>
</a>
<a href=javascript:void(0); data-menu=#menu-main_menu class=nav-menu-toggle><span class=material-icons>menu</span></a>
<ul id=menu-main_menu class="nav-menu h-0 md:h-auto">
<form class="nav-menu-search-bar md:hidden relative">
<button class="nav-menu-search-bar-search-btn absolute h-full"><svg class="w-3 h-3 text-gray-600" fill="currentcolor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.32 14.9l5.39 5.4a1 1 0 01-1.42 1.4l-5.38-5.38a8 8 0 111.41-1.41zM10 16a6 6 0 100-12 6 6 0 000 12z"/></svg>
</button>
<input name=s type=text class=w-full>
</form>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com/categories/systemdesign>System Design
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/software-architecture>Software Architecture</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/microservice-architecture>Microservice Architecture</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/aws>Learn AWS The Right Way</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/aws-labs>AWS Hands-On Labs</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com/categories/cheatsheet>Cheatsheet
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nestjs-examples>NestJS Examples</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/reactjs-examples>ReactJS Examples</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/react-native-examples>React Native Examples</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com/categories/frameworks>Frameworks
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nestjs>NestJS</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/reactjs>ReactJS</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nextjs>NextJS</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com>Tutorials
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nestjs-tutorial>NestJS Tutorial</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/reactjs-tutorial>ReactJS Tutorial</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nextjs-tutorial>NextJS Tutorial</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com>Tools
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://regex101.com/>Online Regex</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=http://www.bashoneliners.com/>Bash Online</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://www.epochconverter.com/>Unix Timestamp Conversion</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://ryanstutorials.net/bash-scripting-tutorial/>Bash Scripting</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://explainshell.com/>Explain Shell</a></li>
</ul>
</li>
<form class="nav-menu-search-bar hidden md:flex relative">
<button class="nav-menu-search-bar-search-btn absolute h-full"><svg class="w-3 h-3 text-gray-600" fill="currentcolor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.32 14.9l5.39 5.4a1 1 0 01-1.42 1.4l-5.38-5.38a8 8 0 111.41-1.41zM10 16a6 6 0 100-12 6 6 0 000 12z"/></svg>
</button>
<input name=s type=text class=w-full>
</form>
</ul>
</div>
</div>
</nav>
<main>
<section class="container section">
<div class="page-content max-w-2xl mx-auto">
<img src=https://user-images.githubusercontent.com/31009750/269891173-f10b1b6b-ea34-4e23-91b6-db9e995d6bff.png class=img-responsive alt="Microservice Headfirst">
<h1>Microservice Headfirst</h1>
<p><strong>Post Date</strong> : 2024-04-19T08:27:33+07:00</p>
<p><strong>Modified Date</strong> : 2024-04-19T08:27:33+07:00</p>
<p>
<strong>Category:</strong>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=https://nextjsvietnam.com/categories/systemdesign>systemdesign</a>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=https://nextjsvietnam.com/categories/microservice-architecture>microservice-architecture</a>
</p>
<p>
<strong>Tags:</strong>
</p>
<p>In theory, you will split your monolith application in to microservices like this</p>
<p><img src=https://gist.github.com/assets/31009750/a9f0ee0a-c2e7-4896-9dda-d2da9cf2a43d alt=image></p>
<p>And the biggest issue we have to face is Data Management Between Services</p>
<p><img src=https://gist.github.com/assets/31009750/3850f906-aa90-4a76-b7c0-4fe5f553c27a alt=image></p>
<p>In this article, we will go through 2 sections to help you dive in deeper in microservice world.</p>
<ul>
<li><input disabled type=checkbox> Microservice Pattern</li>
<li><input disabled type=checkbox> Practice: build a shopping website with microservice architecture</li>
</ul>
<h2 id=microservice-pattern>Microservice Pattern</h2>
<h3 id=database-per-service>Database Per Service</h3>
<ul>
<li>We want each service to run independently of other services</li>
<li>Database schema/structure might change unexpectedly</li>
<li>Some services might function more efficiently with different types of DB&rsquo;s (sql, non-sql)</li>
</ul>
<p>Some issues we may got if we don&rsquo;t apply this pattern</p>
<p><strong>DB for All</strong></p>
<p><img src=https://gist.github.com/assets/31009750/0bd8745d-f0a6-4d10-a1d4-63b47706e808 alt=image></p>
<p><strong>Access to another service&rsquo;s DB</strong></p>
<p><img src=https://gist.github.com/assets/31009750/a980bf70-73e5-40d2-b102-2d5e2a5348c1 alt=image></p>
<h3 id=communication-strategies-between-services>Communication strategies between services</h3>
<p>This is our problem, as we do know, each services has their own database if needed.
So how do we manage communications between services when they need information from another services.</p>
<p>There are many ways to do that, but in general, they had been organized into 2 categories: <strong>sync</strong> and <strong>async</strong></p>
<p><img src=https://gist.github.com/assets/31009750/52f446fb-4e97-4897-ad37-b2cfd80df382 alt=image></p>
<h4 id=sync>Sync</h4>
<blockquote>
<p>Services communicate with each other using direct requests. Whatever protocol or data format.</p>
</blockquote>
<p><img src=https://gist.github.com/assets/31009750/829f6d30-4550-46e9-8fc7-d2e93c9a74b8 alt=image></p>
<h4 id=async>Async</h4>
<blockquote>
<p>Services communicate with each other using events.</p>
</blockquote>
<p><img src=https://gist.github.com/assets/31009750/2731da6b-aae6-4724-ac75-81b15fd9e5c3 alt=image></p>
<p>But looks like it can&rsquo;t solve the issues that sync strategy introduce.</p>
<h3 id=command-query-responsibility-segregation>Command Query Responsibility Segregation</h3>
<p><img src=https://gist.github.com/assets/31009750/90400553-0be0-4f23-88fd-5800f36370df alt=image></p>
<ul>
<li><a href=https://microservices.io/patterns/data/cqrs.html>CQRS</a></li>
</ul>
<p>Let&rsquo;s dive in this example. We have an app with posts and allow user to create comments.
Apply this pattern we&rsquo;ll have the following services. And this is how these service interact when users add their new comments.</p>
<p><img src=https://gist.github.com/assets/31009750/00d1e071-bf91-4f13-b5ec-d2ca86c469f5 alt=image></p>
<p><img src=https://gist.github.com/assets/31009750/74369f87-29d5-47ac-82a7-aa7654b710f8 alt=image></p>
<p>But the business logic in the event is too precised. And what if we have a lot of features and services that applied this pattern.</p>
<p><img src=https://gist.github.com/assets/31009750/439e2489-51c6-4a57-abfe-0b20c6b150f9 alt=image></p>
<p>Finally, we may end up with event hell!!!</p>
<p><img src=https://gist.github.com/assets/31009750/0f2f7069-c8bf-4b3f-895d-a92058c256da alt=image></p>
<p>So the solution is the service should have a deep understanding about the business in the event.
So we&rsquo;ll apply this &ldquo;Single Responsibility&rdquo;, in this example CommentService is in charge of comment logic. Query service should only care about the generic event of the comment.</p>
<p><img src=https://gist.github.com/assets/31009750/13446e5f-9bec-4187-be63-7278374bc39f alt=image></p>
<p>So Query Service only need to listen for update comment, just update</p>
<p><img src=https://gist.github.com/assets/31009750/1c160a59-1f37-42c5-877e-c24561e035d0 alt=image></p>
<h3 id=how-do-we-deal-with-missing-events>How do we deal with missing events</h3>
<p>Your services, somehow, it had been down for a while</p>
<p><img src=https://gist.github.com/assets/31009750/c50cb841-4b0c-4b8b-b794-b319f7ca23fe alt=image></p>
<p>You add a new service after your system run for a couple of months or even year</p>
<p><img src=https://gist.github.com/assets/31009750/261781ee-a6fb-4144-9d5a-728e20cacc10 alt=image></p>
<p>There are 3 options to solve this problem.</p>
<h4 id=option-1---sync-requests>Option 1 - Sync Requests</h4>
<p><img src=https://gist.github.com/assets/31009750/b7bb0857-33ce-427f-83ee-bac8161315f7 alt=image></p>
<h4 id=option-2---direct-access>Option 2 - Direct Access</h4>
<p><img src=https://gist.github.com/assets/31009750/f9eb2191-cec2-4b2b-a90b-a1699c642f30 alt=image></p>
<p><img src=https://gist.github.com/assets/31009750/baeb2aab-5472-4be0-ae1f-23dd9258b10e alt=image></p>
<h4 id=option-3---store-events>Option 3 - Store Events</h4>
<p><img src=https://gist.github.com/assets/31009750/97eb7414-9461-4fe1-a056-7565108734c9 alt=image></p>
<p><img src=https://gist.github.com/assets/31009750/2e4e2c80-5137-44b4-afea-f02768c58d62 alt=image></p>
<h3 id=deployment>Deployment</h3>
<p><img src=https://gist.github.com/assets/31009750/cec73733-c810-475d-83b7-3b6a8fbbf901 alt=image></p>
<p>Docker?</p>
<p><img src=https://gist.github.com/assets/31009750/33f19ff9-c1a2-496d-92a2-d5410dd5ed35 alt=image></p>
<p>Yes, but not enough.
With k8s, things will be more easier.</p>
<p><img src=https://gist.github.com/assets/31009750/e0cefe66-c4af-4aaa-9e1e-9efd4977d7f4 alt=image></p>
<p>Quick note for k8s components</p>
<p><img src=https://gist.github.com/assets/31009750/36921dfe-54d8-42f6-a7d7-d0c5bbc38928 alt=image></p>
<h2 id=practice>Practice</h2>
<p>Let assume that we have a monolith application looks like this</p>
<p><img src=https://gist.github.com/assets/31009750/d9c17d0c-4181-4ab6-9798-6c556e2a1793 alt=image></p>
<p>Your mission is to refactor this application with microservice architecture. The application has 2 parts: SPA(NextJS) + API (built with your microservices)</p>
<div class="m-1 p-1">
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=https://nextjsvietnam.com/categories/systemdesign>systemdesign</a>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=https://nextjsvietnam.com/categories/microservice-architecture>microservice-architecture</a>
</div>
</div>
</section>
<section class="container section">
<div class="max-w-2xl mx-auto">
<div class="font-heading text-2xl font-semibold">You Might Also Like</div>
<div class="mt-8 grid gap-8">
<ul class=sidebar-links>
<li><a href=/post/aws-lab-series-build-and-deploy-rest-api/>Aws Lab Series Build and Deploy Rest Api</a></li>
<li><a href=/post/aws-lab-series-foreword/>Aws Lab Series Foreword</a></li>
<li><a href=/post/aws-series-migration/>Aws Series Migration</a></li>
<li><a href=/post/aws-series-governance/>Aws Series Governance</a></li>
<li><a href=/post/aws-series-caching/>Aws Series Caching</a></li>
<li><a href=/post/aws-series-automation/>Aws Series Automation</a></li>
<li><a href=/post/aws-series-security/>Aws Series Security</a></li>
</ul>
</div>
</div>
</section>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1642510310947288" crossorigin=anonymous></script>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1642510310947288 data-ad-slot=9309117729></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script>
</main>
<footer class=footer>
<div class="container md:flex">
<section class="footer-section-info md:basis-1/4">
<div class=address>
<a class=logo href=https://nextjsvietnam.com title=NextJSVietNam>
NextJSVietNam
</a>
<h4 class=footer-heading>
PRODUCTION MODE
<h4>
</div>
</section>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>NestJS</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/nestjs-passing-data-between-layers-in-ddd/>Nestjs Passing Data Between Layers in Domain Driven Design</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai-06-viet-unit-test/>Khóa học NestJS - Bài 06 Hướng dẫn viết Unit Test</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai-05-repository-pattern/>Khóa học NestJS Bài 05 - Repository Pattern</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai-04-model-and-repository-pattern/>Khóa học NestJS Bài 04 - Model and Repository Pattern</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai03/>Khóa học NestJS Bài 03 - Controllers & Views</a></li>
</ul>
</div>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>NextJS</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nextjs-bai-03-advanced-routing/>Khoá học NextJS Bài 03 - Advanced Routing</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nextjs-bai-02-cau-truc-du-an-nextjs/>Khoá học NextJS 2024 - Bài 02: Cấu trúc dự án NextJS</a></li>
<li><a href=https://nextjsvietnam.com/post/create-new-website-with-nextjs/>Create New Website With Nextjs</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nextjs/>Khóa học NextJS - Bài 01 - Lộ trình các bài học về NextJS</a></li>
</ul>
</div>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>Cheatsheet</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/6minutes-tech-graphql/>6minutes Tech Graphql</a></li>
<li><a href=https://nextjsvietnam.com/post/6minutes-tech-progressive-web-app/>6minutes Tech Progressive Web App</a></li>
<li><a href=https://nextjsvietnam.com/post/flexbox-and-real-world-examples/>Flexbox and Real World Examples</a></li>
<li><a href=https://nextjsvietnam.com/post/react-native-examples-setup-working-place-for-react-native-developer/>[React Native Examples] Setup Working Place for React Native Developer</a></li>
<li><a href=https://nextjsvietnam.com/post/happy-new-year-2024/>Happy New Year 2024</a></li>
</ul>
</div>
</div>
<div class=container>
<div class=text-center>
<a href><span class="material-icons text-4xl m-4">facebook</span></a>
<a href><span class="material-icons text-4xl m-4">smart_display</span></a>
</div>
<div class="text-center text-lg py-4">
Copyright @ NextJSVietNam 2022
</div>
<div class="text-center text-sm">
Powered by <a class="font-bold text-primary" href=https://gohugo.io/>Go Hugo</a> - Made
with love from <a class="font-bold text-primary" href=https://nextjsvietnam.com>NextJSVietNam</a> -
Build
Version 2024-05-20 08:51:24 +0700 +0700
</div>
</div>
</footer>
<script type=text/javascript src=https://nextjsvietnam.com/core/jquery-3.6.0.min.js></script>
<script type=text/javascript src=https://nextjsvietnam.com/themes/2022/public/main.js></script>
<script type=text/javascript src=https://nextjsvietnam.com/themes/2022/public/home.js></script>
<script async>!function(b,e,f,g,a,c,d){if(b.fbq)return;a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version='2.0',a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js'),fbq('init','1760611910980690'),fbq('track','PageView')</script>
<noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=1760611910980690&ev=PageView&noscript=1"></noscript>
</body>
</html>