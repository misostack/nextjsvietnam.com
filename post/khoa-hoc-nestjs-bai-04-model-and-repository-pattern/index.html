<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=home href=https://nextjsvietnam.com>
<meta name=generator content="jsguru cms">
<link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap">
<link rel=stylesheet href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/main.css>
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/home.css>
<link rel=stylesheet href=https://nextjsvietnam.com/themes/2022/public/page.css>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RWE4MLJYE6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-RWE4MLJYE6')</script>
<title>Khóa học NestJS Bài 04 - Model and Repository Pattern | Cùng tìm hiểu về Model trong MVC và so sánh giữa ActiveRecord với Repository Pattern trong NestJS | Useful NodeJS Tricks, JavaScript Tips, Tricks and Best Practices</title>
<meta name=robots content="all">
<meta name=keywords content="nestjs,nestjs-mvc,nestjs-tutorial">
<meta name=description content="Cùng tìm hiểu về Model trong MVC và so sánh giữa ActiveRecord với Repository Pattern trong NestJS">
<meta property="og:type" content="website">
<meta property="og:image" content="https://user-images.githubusercontent.com/31009750/181449337-70081a76-5a01-4229-805e-39ed0ded6b5b.png">
<meta property="og:image:type" content="image/jpeg">
<meta property="og:image:width" content="750">
<meta property="og:image:height" content="300">
<meta property="article:publisher" content="https://www.facebook.com/nextjsvietnam">
<meta property="article:published_time" content="2023-07-03T14:29:29+07:00">
<meta property="article:modified_time" content="2023-07-03T14:29:29+07:00">
<link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png>
<link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png>
<link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png>
<link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png>
<link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png>
<link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png>
<link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png>
<link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png>
<link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png>
<link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<meta name=msapplication-TileColor content="#ffffff">
<meta name=msapplication-TileImage content="/ms-icon-144x144.png">
<meta name=theme-color content="#ffffff">
</head>
<body class=body-nav-fixed>
<nav class="nav-fixed nav-default z-50">
<div class=container>
<div class="nav-container flex flex-wrap justify-between items-center">
<a href=https://nextjsvietnam.com class="nav-brand inline-block">
<img class=h-12 src=https://nextjsvietnam.com/themes/2022/src/assets/images/logo.png alt=Stunning>
</a>
<a href=javascript:void(0); data-menu=#menu-main_menu class=nav-menu-toggle><span class=material-icons>menu</span></a>
<ul id=menu-main_menu class="nav-menu h-0 md:h-auto">
<form class="nav-menu-search-bar md:hidden relative">
<button class="nav-menu-search-bar-search-btn absolute h-full"><svg class="w-3 h-3 text-gray-600" fill="currentcolor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.32 14.9l5.39 5.4a1 1 0 01-1.42 1.4l-5.38-5.38a8 8 0 111.41-1.41zM10 16a6 6 0 100-12 6 6 0 000 12z"/></svg>
</button>
<input name=s type=text class=w-full>
</form>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com/categories/cheatsheet>Cheatsheet
</a>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com/categories/frameworks>Frameworks
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nestjs>NestJS</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/reactjs>ReactJS</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nextjs>NextJS</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com>Tutorials
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nestjs-tutorial>NestJS Tutorial</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/reactjs-tutorial>ReactJS Tutorial</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://nextjsvietnam.com/categories/nextjs-tutorial>NextJS Tutorial</a></li>
</ul>
</li>
<li class=nav-menu-item>
<a class=nav-menu-link href=https://nextjsvietnam.com>Tools
<span class=material-icons>keyboard_arrow_down</span>
</a>
<ul class=sub-menu>
<li class=nav-menu-item><a class=nav-menu-link href=https://regex101.com/>Online Regex</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=http://www.bashoneliners.com/>Bash Online</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://www.epochconverter.com/>Unix Timestamp Conversion</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://ryanstutorials.net/bash-scripting-tutorial/>Bash Scripting</a></li>
<li class=nav-menu-item><a class=nav-menu-link href=https://explainshell.com/>Explain Shell</a></li>
</ul>
</li>
<form class="nav-menu-search-bar hidden md:flex relative">
<button class="nav-menu-search-bar-search-btn absolute h-full"><svg class="w-3 h-3 text-gray-600" fill="currentcolor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.32 14.9l5.39 5.4a1 1 0 01-1.42 1.4l-5.38-5.38a8 8 0 111.41-1.41zM10 16a6 6 0 100-12 6 6 0 000 12z"/></svg>
</button>
<input name=s type=text class=w-full>
</form>
</ul>
</div>
</div>
</nav>
<main>
<section class="container section">
<div class="page-content max-w-2xl mx-auto">
<img src=https://user-images.githubusercontent.com/31009750/181449337-70081a76-5a01-4229-805e-39ed0ded6b5b.png class=img-responsive alt="Khóa học NestJS Bài 04 - Model and Repository Pattern">
<h1>Khóa học NestJS Bài 04 - Model and Repository Pattern</h1>
<p><strong>Post Date</strong> : 2023-07-03T14:29:29+07:00</p>
<p><strong>Modified Date</strong> : 2023-07-03T14:29:29+07:00</p>
<p>
<strong>Category:</strong>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=https://nextjsvietnam.com/categories/nestjs-tutorial>nestjs-tutorial</a>
</p>
<p>
<strong>Tags:</strong>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=/tags/nestjs>nestjs</a>
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=/tags/nestjs-pet-website>, nestjs-pet-website</a>
</p>
<h2 id=source-code>Source Code</h2>
<ul>
<li><a href=https://github.com/misostack/nestjs-tutorial-2023/tree/lession04>Lession 04 Source Code</a></li>
</ul>
<h2 id=bài-04>Bài 04</h2>
<ol>
<li>Giới thiệu sơ qua về một số ORM phổ biến : Sequelize, TypeORM, Mongoose</li>
<li>Tìm hiểu về ActiveRecord Pattern</li>
<li>Tìm hiểu về Repository Pattern</li>
<li>Ứng dụng để tạo database schema với TypeORM trong NestJS</li>
<li>Ứng dụng để tạo data seed trong NestJS</li>
</ol>
<h3 id=1-cấu-hình-cho-nestjs-làm-với-với-mysql-thông-qua-typeorm>1. Cấu hình cho NestJS làm với với MySQL thông qua TypeORM</h3>
<p>Đầu tiên bạn cần tạo database trước
Database name : <strong>nestjs_tutorial_2023</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>DATABASE</span> <span style=color:#f92672>`</span>nestjs_tutorial_2023<span style=color:#f92672>`</span> CHARACTER <span style=color:#66d9ef>SET</span> <span style=color:#e6db74>&#39;utf8mb4&#39;</span> <span style=color:#66d9ef>COLLATE</span> <span style=color:#e6db74>&#39;utf8mb4_bin&#39;</span>;
</code></pre></div><p><img src=https://user-images.githubusercontent.com/31009750/250492489-8e106e4c-640f-4aea-84d4-d3663f223c02.png alt=image></p>
<ul>
<li>Kết nối với MYSQL bằng Sequelize</li>
<li>Kết nối với PostgreSQL bằng TypeORM</li>
<li>Kết nối với MongoDB bằng Mongoose</li>
</ul>
<p><strong>1.1. Kết nối với MYSQL bằng Sequelize</strong></p>
<p>Cài đặt các packages</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>npm install --save @nestjs/sequelize sequelize sequelize-typescript mysql2
npm install --save-dev @types/sequelize
npm install --save-dev sequelize-cli
npx sequelize-cli init
</code></pre></div><p>Trong phần này tôi xin giới thiệu với các anh chị 3 bước chính làm việc với database:</p>
<ol>
<li><input checked disabled type=checkbox> Thiết lập kết nối</li>
<li><input checked disabled type=checkbox> Khai báo model</li>
<li><input checked disabled type=checkbox> Cấu trúc thư mục database migration - khởi tạo, cập nhật database schema</li>
</ol>
<blockquote>
<p>Thiết lập kết nối</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#75715e>// src/app.module.ts
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Module</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@nestjs/common&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ServeStaticModule</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@nestjs/serve-static&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>join</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;path&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>PetModule</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./pet/pet.module&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>SequelizeModule</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@nestjs/sequelize&#34;</span>;

<span style=color:#66d9ef>@Module</span>({
  <span style=color:#a6e22e>imports</span><span style=color:#f92672>:</span> [
    <span style=color:#75715e>// public folder
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>ServeStaticModule</span>.<span style=color:#a6e22e>forRoot</span>({
      <span style=color:#a6e22e>rootPath</span>: <span style=color:#66d9ef>join</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>cwd</span>(), <span style=color:#e6db74>&#34;public&#34;</span>),
      <span style=color:#a6e22e>serveRoot</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/public&#34;</span>,
    }),
    <span style=color:#a6e22e>PetModule</span>,
    <span style=color:#a6e22e>SequelizeModule</span>.<span style=color:#a6e22e>forRoot</span>({
      <span style=color:#a6e22e>dialect</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mysql&#34;</span>,
      <span style=color:#a6e22e>host</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;localhost&#34;</span>,
      <span style=color:#a6e22e>port</span>: <span style=color:#66d9ef>3306</span>,
      <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;root&#34;</span>,
      <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;123456&#34;</span>,
      <span style=color:#a6e22e>database</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;nestjs_tutorial_2023&#34;</span>,
      <span style=color:#a6e22e>models</span><span style=color:#f92672>:</span> [],
    }),
  ],
  <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [],
})
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppModule</span> {}
</code></pre></div><blockquote>
<p>Khai báo model</p>
</blockquote>
<p><strong>Model trong ORM:</strong></p>
<ul>
<li>Chính là ánh xạ của 1 thực thể trong cơ sở dữ liệu, thông qua ORM chúng ta chỉ cần làm việc với các phương thức (method) của Model, phần còn lại là các câu lệnh SQL/NoSQL sẽ được ORM xử lý. Ưu điểm là việc lập trình sẽ trở nên dễ dàng và có tính nhất quán hơn. Nhược điểm là đôi khi 1 số câu query sẽ chậm và khó để triển khai các query có tính chất phức tạp. Tuy nhiên với trường hợp đó ORM vẫn hỗ trợ chúng thực hiện SQL/NoSQL query truyền thống.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Column</span>, <span style=color:#a6e22e>DataType</span>, <span style=color:#a6e22e>Model</span>, <span style=color:#a6e22e>Table</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;sequelize-typescript&#34;</span>;

<span style=color:#66d9ef>@Table</span>({
  <span style=color:#a6e22e>tableName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;pet_categories&#34;</span>,
})
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PetCategory</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Model</span> {
  <span style=color:#66d9ef>@Column</span>({
    <span style=color:#a6e22e>primaryKey</span>: <span style=color:#66d9ef>true</span>,
    <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>DataType</span>.<span style=color:#a6e22e>UUID</span>,
    <span style=color:#a6e22e>defaultValue</span>: <span style=color:#66d9ef>DataType.UUIDV4</span>,
  })
  <span style=color:#a6e22e>id?</span>: <span style=color:#66d9ef>string</span>;

  <span style=color:#66d9ef>@Column</span>({
    <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>DataType</span>.<span style=color:#a6e22e>STRING</span>(<span style=color:#ae81ff>60</span>),
    <span style=color:#a6e22e>allowNull</span>: <span style=color:#66d9ef>false</span>,
  })
  <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
}
</code></pre></div><blockquote>
<p>Điều chỉnh lại config để sử dụng model và sử dụng database uri</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#75715e>// src/app.module.ts
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Module</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@nestjs/common&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ServeStaticModule</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@nestjs/serve-static&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>join</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;path&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>PetModule</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./pet/pet.module&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>SequelizeModule</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;@nestjs/sequelize&#34;</span>;
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>models</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;./pet/models&#34;</span>;

<span style=color:#66d9ef>@Module</span>({
  <span style=color:#a6e22e>imports</span><span style=color:#f92672>:</span> [
    <span style=color:#75715e>// public folder
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>ServeStaticModule</span>.<span style=color:#a6e22e>forRoot</span>({
      <span style=color:#a6e22e>rootPath</span>: <span style=color:#66d9ef>join</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>cwd</span>(), <span style=color:#e6db74>&#34;public&#34;</span>),
      <span style=color:#a6e22e>serveRoot</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/public&#34;</span>,
    }),
    <span style=color:#a6e22e>PetModule</span>,
    <span style=color:#a6e22e>SequelizeModule</span>.<span style=color:#a6e22e>forRoot</span>({
      <span style=color:#a6e22e>uri</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mysql://root:123456@localhost/nestjs_tutorial_2023&#34;</span>,
      <span style=color:#a6e22e>dialect</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mysql&#34;</span>,
      <span style=color:#a6e22e>models</span>: <span style=color:#66d9ef>models</span>,
    }),
  ],
  <span style=color:#a6e22e>providers</span><span style=color:#f92672>:</span> [],
})
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppModule</span> {}
</code></pre></div><blockquote>
<p>Cấu trúc thư mục database migration - khởi tạo, cập nhật database schema</p>
</blockquote>
<p>Đôi lời giải thích tại sao chúng ta cần sử dụng sequelize-cli để cập nhật database.
Trong quá trình phát triển dự án, khi có 1 bảng dữ liệu cần thêm mới/xóa hoặc cập nhật các cột trong bảng. Cách trực tiếp nhất là các câu lệnh SQL, mặc dù chúng ta vẫn có thể quản lí được câu lệnh nào đã chạy hoặc chưa và việc chia sẻ với các thành viên trong team hoặc người phụ trách triển khai sản phẩm trên môi trường production.</p>
<p>Trong các ORM hiện đại ngày nay, để thống nhất cách làm và quy chuẩn hóa, thông thường chúng ta sẽ sử dụng cli của các ORM này liên quan đến với tạo/chỉnh sửa database, table.
Và thực hiện việc migrate qua các dòng lệnh. Còn cấu trúc các bảng dữ liệu sẽ được triển khai thông qua code - nhằm mang tính thống nhất với model đã được quản lí bởi ORM.</p>
<p>Sau khi chạy câu lệnh mặc định sau của sequelize-cli chúng ta sẽ có cấu trúc thư mục mặc định như sau.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>npx sequelize-cli init
</code></pre></div><pre tabindex=0><code class=language-xs data-lang=xs>config
  database.json
db
  models
  seeders
  migrations
</code></pre><blockquote>
<p><strong>.sequelizerc</strong></p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// .sequelizerc
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;path&#34;</span>);

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>config</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#34;config&#34;</span>, <span style=color:#e6db74>&#34;database.json&#34;</span>),
  <span style=color:#e6db74>&#34;models-path&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#34;db&#34;</span>, <span style=color:#e6db74>&#34;models&#34;</span>),
  <span style=color:#e6db74>&#34;seeders-path&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#34;db&#34;</span>, <span style=color:#e6db74>&#34;seeders&#34;</span>),
  <span style=color:#e6db74>&#34;migrations-path&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#34;db&#34;</span>, <span style=color:#e6db74>&#34;migrations&#34;</span>),
};
</code></pre></div><p>Tuy nhiên để phù hợp với cấu trúc hiện tại của dự án, ta cần điều chỉnh lại 1 chút như sau</p>
<pre tabindex=0><code class=language-xss data-lang=xss>src
    database
        config
            config.ts
    migrations
        *.ts
    seeds
        *.ts
</code></pre><blockquote>
<p><strong>.sequelizerc</strong></p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>path</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;path&#34;</span>);

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>config</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#34;./dist/database/config/config.js&#34;</span>),
  <span style=color:#e6db74>&#34;seeders-path&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#34;./dist/database/seeders&#34;</span>),
  <span style=color:#e6db74>&#34;migrations-path&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#34;./dist/database/migrations&#34;</span>),
};
</code></pre></div><p>Ở đây, thay vì chạy trực tiếp bản source, chúng ta sẽ chạy bản build của chúng</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#75715e>// config.ts
</span><span style=color:#75715e></span><span style=color:#66d9ef>module</span><span style=color:#a6e22e>.exports</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>production</span><span style=color:#f92672>:</span> {
    <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mysql://root:123456@localhost/nestjs_tutorial_2023&#34;</span>,
    <span style=color:#a6e22e>dialect</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;mysql&#34;</span>,
  },
};
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#75715e>// src\database\migrations\20230704043449-create-pet-category-table.ts
</span><span style=color:#75715e></span><span style=color:#e6db74>&#34;use strict&#34;</span>;

<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>PetCategory</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;src/pet/models/pet-category.model&#34;</span>;

<span style=color:#75715e>/** @type {import(&#39;sequelize-cli&#39;).Migration} */</span>

<span style=color:#66d9ef>module</span><span style=color:#a6e22e>.exports</span> <span style=color:#f92672>=</span> {
  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>up</span>(<span style=color:#a6e22e>queryInterface</span>, <span style=color:#a6e22e>Sequelize</span>) {
    <span style=color:#75715e>/**
</span><span style=color:#75715e>     * Add altering commands here.
</span><span style=color:#75715e>     *
</span><span style=color:#75715e>     * Example:
</span><span style=color:#75715e>     * await queryInterface.createTable(&#39;users&#39;, { id: Sequelize.INTEGER });
</span><span style=color:#75715e>     */</span>
    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>createTable</span>(<span style=color:#e6db74>&#34;pet_categories&#34;</span>, {
      <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> {
        <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>UUID</span>,
        <span style=color:#a6e22e>defaultValue</span>: <span style=color:#66d9ef>Sequelize.UUIDV4</span>,
        <span style=color:#a6e22e>primaryKey</span>: <span style=color:#66d9ef>true</span>,
      },
      <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> {
        <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span>(<span style=color:#ae81ff>60</span>),
        <span style=color:#a6e22e>allowNull</span>: <span style=color:#66d9ef>false</span>,
      },
    });
  },

  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>down</span>(<span style=color:#a6e22e>queryInterface</span>, <span style=color:#a6e22e>Sequelize</span>) {
    <span style=color:#75715e>/**
</span><span style=color:#75715e>     * Add reverting commands here.
</span><span style=color:#75715e>     *
</span><span style=color:#75715e>     * Example:
</span><span style=color:#75715e>     * await queryInterface.dropTable(&#39;users&#39;);
</span><span style=color:#75715e>     */</span>
    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>dropTable</span>(<span style=color:#e6db74>&#34;pet_categories&#34;</span>);
  },
};
</code></pre></div><p><strong>Một số command phổ biến</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ npx sequelize-cli --help

Sequelize CLI <span style=color:#f92672>[</span>Node: 16.19.1, CLI: 6.6.1, ORM: 6.32.1<span style=color:#f92672>]</span>

sequelize &lt;command&gt;

Commands:
  sequelize db:migrate                        Run pending migrations
  sequelize db:migrate:schema:timestamps:add  Update migration table to have timestamps
  sequelize db:migrate:status                 List the status of all migrations
  sequelize db:migrate:undo                   Reverts a migration
  sequelize db:migrate:undo:all               Revert all migrations ran
  sequelize db:seed                           Run specified seeder
  sequelize db:seed:undo                      Deletes data from the database
  sequelize db:seed:all                       Run every seeder
  sequelize db:seed:undo:all                  Deletes data from the database
  sequelize db:create                         Create database specified by configuration
  sequelize db:drop                           Drop database specified by configuration
  sequelize init                              Initializes project
  sequelize init:config                       Initializes configuration
  sequelize init:migrations                   Initializes migrations
  sequelize init:models                       Initializes models
  sequelize init:seeders                      Initializes seeders
  sequelize migration:generate                Generates a new migration file
  sequelize migration:create                  Generates a new migration file
  sequelize model:generate                    Generates a model and its migration
  sequelize model:create                      Generates a model and its migration
  sequelize seed:generate                     Generates a new seed file
  sequelize seed:create                       Generates a new seed file
</code></pre></div><p><strong>Tôi xin ví dụ command để thực hiện tạo file migration, sau đó build, và chạy</strong></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># create migration</span>
npx sequelize-cli migration:create --name create-pet-category-table --migrations-path ./src/database/migrations
<span style=color:#75715e># build</span>
npm run build
<span style=color:#75715e># run migration</span>
npx sequelize-cli db:migrate --env production
</code></pre></div><p>Lưu ý nếu không chỉ định env thì mặc định là development. Như trong file config ở trên chúng ta chỉ set duy nhất một môi trường là production. Và các config sẽ được thay thế bằng biến môi trường.</p>
<p>Sau khi chạy migrate xong lúc này kiểm tra database ta sẽ thấy</p>
<p><img src=https://user-images.githubusercontent.com/31009750/250809387-f3fc13a6-8ece-4e34-bb45-c813f59828b2.png alt=image></p>
<p><img src=https://user-images.githubusercontent.com/31009750/250809558-b78684c7-a441-4eec-ab4c-0cc201ef78bc.png alt=image></p>
<p>Bước tiếp theo, chúng ta bắt đầu test thử một số method cơ bản của Model: thêm, cập nhật, xóa, tìm kiếm</p>
<div class="m-1 p-1">
<a class="m-1 p-1 text-xs font-bold leading-none border border-gray-200 bg-white" href=https://nextjsvietnam.com/categories/nestjs-tutorial>nestjs-tutorial</a>
</div>
</div>
</section>
<section class="container section">
<div class="max-w-2xl mx-auto">
<div class="font-heading text-2xl font-semibold">You Might Also Like</div>
<div class="mt-8 grid gap-8">
<ul class=sidebar-links>
<li><a href=/post/khoa-hoc-nestjs-bai03/>Khóa học NestJS Bài 03 - Controllers & Views</a></li>
<li><a href=/post/khoa-hoc-nestjs-bai-02/>Khóa học Nestjs - Bài 02 - Giới thiệu mô hình MVC</a></li>
<li><a href=/post/khoa-hoc-nestjs/>Khóa học NestJS - Bài 01 - Lộ trình các bài học về NestJS Framework</a></li>
</ul>
</div>
</div>
</section>
</main>
<footer class=footer>
<div class="container md:flex">
<section class="footer-section-info md:basis-1/4">
<div class=address>
<a class=logo href=https://nextjsvietnam.com title=NextJSVietNam>
NextJSVietNam
</a>
<h4 class=footer-heading>
PRODUCTION MODE
<h4>
</div>
</section>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>NestJS</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai-04-model-and-repository-pattern/>Khóa học NestJS Bài 04 - Model and Repository Pattern</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai03/>Khóa học NestJS Bài 03 - Controllers & Views</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs-bai-02/>Khóa học Nestjs - Bài 02 - Giới thiệu mô hình MVC</a></li>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nestjs/>Khóa học NestJS - Bài 01 - Lộ trình các bài học về NestJS Framework</a></li>
<li><a href=https://nextjsvietnam.com/post/build-restful-api-with-nestjs-the-right-way/>Build Restful Api With Nestjs the Right Way</a></li>
</ul>
</div>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>NextJS</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/khoa-hoc-nextjs/>Khóa học NextJS - Bài 01 - Lộ trình các bài học về NextJS</a></li>
<li><a href=https://nextjsvietnam.com/post/create-new-website-with-nextjs/>Create New Website With Nextjs</a></li>
</ul>
</div>
<div class="footer-section-navigation-menu md:basis-1/4">
<h4 class=footer-heading>Cheatsheet</h4>
<ul class=footer-section-navigation-menu-links>
<li><a href=https://nextjsvietnam.com/post/100-frontend-interview-questions/>100 Frontend Interview Questions</a></li>
<li><a href=https://nextjsvietnam.com/post/chatgpt-what-can-chat-gpt-do/>Chatgpt What Can Chat Gpt Do</a></li>
<li><a href=https://nextjsvietnam.com/post/learn-enough-oop-to-be-dangerous/>Learn Enough Oop to Be Dangerous</a></li>
<li><a href=https://nextjsvietnam.com/post/the-future-of-hr/>The Future of Hr</a></li>
<li><a href=https://nextjsvietnam.com/post/how-to-test-the-database/>How to Test the Database</a></li>
</ul>
</div>
</div>
<div class=container>
<div class=text-center>
<a href><span class="material-icons text-4xl m-4">facebook</span></a>
<a href><span class="material-icons text-4xl m-4">smart_display</span></a>
</div>
<div class="text-center text-lg py-4">
Copyright @ NextJSVietNam 2022
</div>
<div class="text-center text-sm">
Powered by <a class="font-bold text-primary" href=https://gohugo.io/>Go Hugo</a> - Made
with love from <a class="font-bold text-primary" href=https://nextjsvietnam.com>NextJSVietNam</a> -
Build
Version 2023-07-03 14:29:29 +0700 +0700
</div>
</div>
</footer>
<script type=text/javascript src=https://nextjsvietnam.com/core/jquery-3.6.0.min.js></script>
<script type=text/javascript src=https://nextjsvietnam.com/themes/2022/public/main.js></script>
<script type=text/javascript src=https://nextjsvietnam.com/themes/2022/public/home.js></script>
<script async>!function(b,e,f,g,a,c,d){if(b.fbq)return;a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version='2.0',a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js'),fbq('init','1760611910980690'),fbq('track','PageView')</script>
<noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=1760611910980690&ev=PageView&noscript=1"></noscript>
</body>
</html>